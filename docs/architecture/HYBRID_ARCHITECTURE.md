# OraSRS 混合层级架构设计文档

## 1. 概述

本架构设计文档描述了OraSRS协议的混合层级架构，包括私有链（自有网络）和公有链（以太坊生态）的集成方案。

## 2. 私有链架构（自有网络）

### 2.1 配置
- **原生代币**: ORA
- **网络ID**: 8888
- **区块时间**: 1秒
- **共识机制**: PoA (权威证明) 或 PoW (工作量证明) 开发模式
- **RPC端点**: http://127.0.0.1:8545

### 2.2 合约部署顺序
1. OraSRSToken - ORA代币合约
2. ThreatIntelligenceCoordination - 威胁情报协调合约
3. OraSRSGovernance - 治理合约
4. EnhancedThreatVerification - 威胁验证合约
5. ThreatIntelSync - 跨链威胁情报同步合约
6. FaucetUpgradeable - 水龙头合约

### 2.3 核心组件
- **Agent**: 威胁情报收集节点
- **私有节点**: 运行全套合约的节点
- **API接口**: 与Splunk/Grafana集成

## 3. 重点测试方案

### 3.1 风险评分算法准确性测试
- 使用历史数据集验证评分模型
- 对比算法预测结果与实际威胁事件
- 调整评分参数以提高准确性

### 3.2 多节点共识效率测试
- 模拟多个Agent同时提交数据
- 测试共识达成时间和效率
- 验证数据一致性和冲突解决机制

### 3.3 存储压力测试
- 模拟大量威胁情报数据上链
- 监控存储使用情况和性能指标
- 测试数据清理和归档机制

## 4. 跨链桥接方案

当协议在自有网络上运行稳定（例如运行100万笔交易）后，可以通过跨链桥接入以太坊生态。

### 4.1 资产上链 (L1/L2)
- 在Optimism/Ethereum上部署OraSRSToken
- 用户在交易所买卖ORA，享受公链流动性

### 4.2 数据映射 (Bridging)
```
用户在公链购买ORA -> 锁仓 -> 跨链桥(Oracle)监测 -> 私有网络生成等量ORA积分
Agent在私有网络赚取ORA积分 -> 提现 -> 跨链桥销毁私有ORA -> 公链释放ORA给用户
```

## 5. Docker Geth 配置

### 5.1 docker-compose.yml
```yaml
version: '3'
services:
  orasrs-chain:
    image: ethereum/client-go:stable
    command: 
      - --dev               # 开发模式 (自动挖矿，秒级出块)
      - --dev.period=1      # 1秒一个块
      - --http              # 开启 HTTP RPC
      - --http.addr=0.0.0.0
      - --http.port=8545
      - --http.api=eth,net,web3,personal,miner
      - --http.corsdomain=*
      - --networkid=8888    # 专属链 ID
    ports:
      - "8545:8545"
```

### 5.2 启动命令
```bash
# 启动网络
docker-compose up -d

# 部署合约
npx hardhat run scripts/deploy_all.js --network my_private_chain
```

## 6. 架构优势

### 6.1 私有链优势
- **速度飞快**: 1秒确认，无需等待
- **完全免费**: 不需要获取ETH，自带无限资金
- **代码复用**: 现有代码可直接部署到其他链

### 6.2 混合架构优势
- **性能与成本**: 私有链处理高频交易，降低Gas费用
- **流动性**: 公链提供代币交易流动性
- **安全性**: 双层架构提供更高安全性

## 7. 实施步骤

### 7.1 阶段一: 私有链部署
1. 部署Geth私有链
2. 部署所有OraSRS合约
3. 配置Agent节点
4. 开始威胁情报收集和处理

### 7.2 阶段二: 测试和优化
1. 进行风险评分算法测试
2. 测试多节点共识效率
3. 评估存储压力
4. 优化合约和算法

### 7.3 阶段三: 跨链集成
1. 部署跨链桥合约
2. 在公链部署代币合约
3. 实现双向资产转移
4. 完成混合架构部署

## 8. 监控和运维

### 8.1 监控指标
- 交易处理速度
- 合约执行Gas消耗
- 存储使用情况
- 网络节点健康状态

### 8.2 运维工具
- 与Splunk集成进行日志分析
- 使用Grafana进行可视化监控
- 自动化部署和升级脚本

## 9. 安全考虑

- 私钥安全管理
- 合约升级机制
- 访问控制和权限管理
- 跨链桥安全审计

## 10. 未来发展

- 与更多公链集成
- 引入零知识证明提升隐私性
- 扩展威胁情报数据源
- 优化AI算法模型