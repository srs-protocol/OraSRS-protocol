# OraSRS å†…æ ¸åŠ é€Ÿä½¿ç”¨æŒ‡å—

## ğŸ“‹ ç›®å½•

1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [ç³»ç»Ÿè¦æ±‚](#ç³»ç»Ÿè¦æ±‚)
3. [å®‰è£…é…ç½®](#å®‰è£…é…ç½®)
4. [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)
5. [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
6. [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)
7. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
8. [FAQ](#faq)

---

## æ¦‚è¿°

OraSRS å†…æ ¸åŠ é€ŸåŠŸèƒ½åŸºäº eBPF (Extended Berkeley Packet Filter) XDP (eXpress Data Path) æŠ€æœ¯ï¼Œåœ¨ Linux å†…æ ¸ç½‘ç»œé©±åŠ¨å±‚å®ç°å¨èƒæ£€æµ‹å’Œé˜»æ–­ï¼Œæä¾›ï¼š

- **çº³ç§’çº§å»¶è¿Ÿ**: < 0.04ms æŸ¥è¯¢å»¶è¿Ÿ
- **é«˜ååé‡**: > 10,000 TPS
- **å®æ—¶é˜»æ–­**: å†…æ ¸çº§æ•°æ®åŒ…è¿‡æ»¤
- **é›¶æ‹·è´**: æ— éœ€æ•°æ®åŒ…æ‹·è´åˆ°ç”¨æˆ·æ€
- **åŠ¨æ€é…ç½®**: è¿è¡Œæ—¶æ¨¡å¼åˆ‡æ¢

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åº”ç”¨ç¨‹åºå±‚                              â”‚
â”‚  (Web æœåŠ¡å™¨ã€æ•°æ®åº“ã€SSH ç­‰)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ å‡ºç«™è¿æ¥
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   eBPF XDP Filter                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  1. è§£ææ•°æ®åŒ… (IP å¤´éƒ¨)                              â”‚  â”‚
â”‚  â”‚  2. æå–ç›®æ ‡ IP åœ°å€                                  â”‚  â”‚
â”‚  â”‚  3. æŸ¥è¯¢ BPF Map (O(1) å“ˆå¸ŒæŸ¥æ‰¾)                     â”‚  â”‚
â”‚  â”‚  4. å†³ç­–: DROP (é˜»æ–­) / PASS (æ”¾è¡Œ)                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                      æ‰§è¡Œæ—¶é—´: < 0.04ms                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ æŸ¥è¯¢
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  å†…æ ¸ BPF Map (å“ˆå¸Œè¡¨)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Key: IP åœ°å€ (uint32)                                â”‚  â”‚
â”‚  â”‚  Value: {                                             â”‚  â”‚
â”‚  â”‚    risk_score: uint8,      // é£é™©è¯„åˆ† (0-100)       â”‚  â”‚
â”‚  â”‚    is_blocked: bool,       // æ˜¯å¦é˜»æ–­               â”‚  â”‚
â”‚  â”‚    last_updated: uint64    // æœ€åæ›´æ–°æ—¶é—´           â”‚  â”‚
â”‚  â”‚  }                                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                      å®¹é‡: 10,000 æ¡è®°å½•                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†‘ åŒæ­¥æ›´æ–°
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              OraSRS Client (ç”¨æˆ·æ€è¿›ç¨‹)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  EgressProtection Module                              â”‚  â”‚
â”‚  â”‚  - åŠ è½½ eBPF ç¨‹åº (egress_loader.py)                 â”‚  â”‚
â”‚  â”‚  - ç®¡ç† BPF Map æ›´æ–°                                  â”‚  â”‚
â”‚  â”‚  - æ”¶é›†ç»Ÿè®¡ä¿¡æ¯                                       â”‚  â”‚
â”‚  â”‚  - åŠ¨æ€é…ç½®ç®¡ç†                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Threat Data Loader                                   â”‚  â”‚
â”‚  â”‚  - ä»åŒºå—é“¾åŒæ­¥å¨èƒæ•°æ®                               â”‚  â”‚
â”‚  â”‚  - åŠ è½½æœ¬åœ°å¨èƒæƒ…æŠ¥                                   â”‚  â”‚
â”‚  â”‚  - å·®åˆ†æ›´æ–° (æ¯å°æ—¶)                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†‘ åŒæ­¥
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   OraSRS åè®®é“¾                              â”‚
â”‚  - å…¨å±€å¨èƒæƒ…æŠ¥æ•°æ®åº“                                        â”‚
â”‚  - Merkle Tree éªŒè¯                                         â”‚
â”‚  - å»ä¸­å¿ƒåŒ–å…±è¯†                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å·¥ä½œæµç¨‹

1. **åˆå§‹åŒ–é˜¶æ®µ**:
   - OraSRS Client å¯åŠ¨
   - åŠ è½½å¨èƒæ•°æ®åˆ°å†…å­˜
   - å¯åŠ¨ eBPF åŠ è½½å™¨ (Python)
   - ç¼–è¯‘å¹¶åŠ è½½ XDP ç¨‹åºåˆ°å†…æ ¸
   - é™„åŠ åˆ°ç½‘ç»œæ¥å£ (eth0)
   - åˆå§‹åŒ– BPF Map
   - åŒæ­¥å¨èƒæ•°æ®åˆ° BPF Map

2. **è¿è¡Œé˜¶æ®µ**:
   - åº”ç”¨ç¨‹åºå‘èµ·å‡ºç«™è¿æ¥
   - XDP ç¨‹åºæ‹¦æˆªæ•°æ®åŒ…
   - æå–ç›®æ ‡ IP åœ°å€
   - æŸ¥è¯¢ BPF Map (çº³ç§’çº§)
   - æ ¹æ®é£é™©è¯„åˆ†å†³ç­–
   - è¿”å› DROP æˆ– PASS

3. **æ›´æ–°é˜¶æ®µ**:
   - æ¯å°æ—¶ä»åŒºå—é“¾åŒæ­¥å·®åˆ†æ›´æ–°
   - æ›´æ–°æœ¬åœ°å¨èƒæ•°æ®
   - åŒæ­¥åˆ° BPF Map
   - æ— éœ€é‡å¯æœåŠ¡

---

## ç³»ç»Ÿè¦æ±‚

### ç¡¬ä»¶è¦æ±‚

| ç»„ä»¶ | æœ€ä½è¦æ±‚ | æ¨èé…ç½® |
|------|----------|----------|
| CPU | 1 æ ¸ | 2 æ ¸+ |
| å†…å­˜ | 512MB | 1GB+ |
| ç£ç›˜ | 1GB | 2GB+ |
| ç½‘å¡ | æ”¯æŒ XDP | æ”¯æŒ Native XDP |

### è½¯ä»¶è¦æ±‚

| è½¯ä»¶ | ç‰ˆæœ¬è¦æ±‚ | è¯´æ˜ |
|------|----------|------|
| Linux Kernel | >= 4.8 | XDP æ”¯æŒ |
| Python | >= 3.6 | BCC ä¾èµ– |
| BCC | >= 0.18.0 | eBPF å·¥å…·é“¾ |
| Node.js | >= 14 | OraSRS Client |
| npm | >= 6 | åŒ…ç®¡ç†å™¨ |

### å†…æ ¸ç‰¹æ€§æ£€æŸ¥

```bash
# æ£€æŸ¥å†…æ ¸ç‰ˆæœ¬
uname -r

# æ£€æŸ¥ XDP æ”¯æŒ
grep -i xdp /boot/config-$(uname -r)

# æ£€æŸ¥ BPF æ”¯æŒ
grep -i bpf /boot/config-$(uname -r)
```

### ç½‘å¡æ”¯æŒæ£€æŸ¥

```bash
# æŸ¥çœ‹ç½‘å¡é©±åŠ¨
ethtool -i eth0

# æ£€æŸ¥ XDP æ”¯æŒ
ip link show eth0 | grep -i xdp
```

**æ”¯æŒ Native XDP çš„ç½‘å¡é©±åŠ¨**:
- `ixgbe` (Intel 10GbE)
- `i40e` (Intel 40GbE)
- `mlx5` (Mellanox ConnectX-4/5)
- `nfp` (Netronome)
- `virtio_net` (è™šæ‹Ÿç½‘å¡ï¼Œéƒ¨åˆ†æ”¯æŒ)

---

## å®‰è£…é…ç½®

### æ–¹æ³• 1: ä¸€é”®å®‰è£… (æ¨è)

```bash
# ä¸‹è½½å¹¶è¿è¡Œå®‰è£…è„šæœ¬
curl -fsSL https://raw.githubusercontent.com/srs-protocol/OraSRS-protocol/lite-client/install-orasrs-client.sh | bash
```

**å®‰è£…è¿‡ç¨‹**:
1. æ£€æµ‹æ“ä½œç³»ç»Ÿå’Œå†…æ ¸ç‰ˆæœ¬
2. å®‰è£…åŸºæœ¬ä¾èµ– (git, node, npm)
3. æ£€æŸ¥ eBPF æ”¯æŒ
4. æç¤ºå®‰è£… BCC (å¯é€‰)
5. å…‹éš†é¡¹ç›®å¹¶é…ç½®
6. å¯åŠ¨æœåŠ¡

### æ–¹æ³• 2: æ‰‹åŠ¨å®‰è£…

#### æ­¥éª¤ 1: å®‰è£… BCC

**Ubuntu/Debian**:
```bash
sudo apt update
sudo apt install -y bpfcc-tools python3-bpfcc linux-headers-$(uname -r)
```

**CentOS/RHEL**:
```bash
sudo yum install -y bcc-tools python3-bcc kernel-devel-$(uname -r)
```

**éªŒè¯å®‰è£…**:
```bash
python3 -c "from bcc import BPF; print('BCC installed successfully')"
```

#### æ­¥éª¤ 2: å®‰è£… OraSRS Client

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/srs-protocol/OraSRS-protocol.git /opt/orasrs
cd /opt/orasrs
git checkout lite-client

# å®‰è£…ä¾èµ–
npm install

# å®‰è£… CLI
chmod +x orasrs-cli.js
ln -s /opt/orasrs/orasrs-cli.js /usr/local/bin/orasrs-cli
```

#### æ­¥éª¤ 3: é…ç½® eBPF

åˆ›å»ºé…ç½®æ–‡ä»¶ `/opt/orasrs/user-config.json`:

```json
{
  "port": 3006,
  "host": "127.0.0.1",
  "egressProtection": {
    "enabled": true,
    "mode": "monitor",
    "interface": "eth0",
    "riskThreshold": 80,
    "cacheUpdateInterval": 300000
  }
}
```

#### æ­¥éª¤ 4: é…ç½® systemd æœåŠ¡

åˆ›å»º `/etc/systemd/system/orasrs-client.service`:

```ini
[Unit]
Description=OraSRS Client Service with eBPF Acceleration
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/opt/orasrs
ExecStart=/usr/bin/node /opt/orasrs/orasrs-simple-client.js
Restart=always
RestartSec=10
Environment=NODE_ENV=production

[Install]
WantedBy=multi-user.target
```

#### æ­¥éª¤ 5: å¯åŠ¨æœåŠ¡

```bash
# é‡è½½ systemd
sudo systemctl daemon-reload

# å¯ç”¨è‡ªå¯åŠ¨
sudo systemctl enable orasrs-client

# å¯åŠ¨æœåŠ¡
sudo systemctl start orasrs-client

# æ£€æŸ¥çŠ¶æ€
sudo systemctl status orasrs-client
```

---

## ä½¿ç”¨æŒ‡å—

### åŸºæœ¬æ“ä½œ

#### æŸ¥çœ‹å†…æ ¸åŠ é€ŸçŠ¶æ€

```bash
# åŸºæœ¬çŠ¶æ€
orasrs-cli kernel

# è¾“å‡ºç¤ºä¾‹:
# ğŸš€ å†…æ ¸åŠ é€ŸçŠ¶æ€
# 
# âœ“ eBPF å†…æ ¸åŠ é€Ÿå·²å¯ç”¨
#   æ¨¡å¼: monitor
#   ç½‘ç»œæ¥å£: eth0
#   å†…æ ¸ç¼“å­˜å¤§å°: 1234 æ¡è®°å½•
#   é£é™©é˜ˆå€¼: 80
#   çŠ¶æ€: running
```

#### æŸ¥çœ‹è¯¦ç»†ç»Ÿè®¡

```bash
# è¯¦ç»†ç»Ÿè®¡ä¿¡æ¯
orasrs-cli kernel --detailed

# è¾“å‡ºåŒ…æ‹¬:
# - æ•°æ®åŒ…ç»Ÿè®¡ (æ€»æ•°ã€é˜»æ–­ã€æ”¾è¡Œ)
# - æ€§èƒ½æŒ‡æ ‡ (å»¶è¿Ÿã€TPSã€å†…å­˜)
# - é£é™©åˆ†å¸ƒ (ä½ã€ä¸­ã€é«˜ã€ä¸¥é‡)
# - è¿è¡Œæ—¶é—´
```

#### æ‰‹åŠ¨åŒæ­¥å¨èƒæ•°æ®

```bash
# åŒæ­¥åˆ°å†…æ ¸
orasrs-cli kernel-sync

# æˆ–ä½¿ç”¨ API
curl -X POST http://localhost:3006/orasrs/v1/kernel/sync
```

### æ¨¡å¼åˆ‡æ¢

#### Monitor æ¨¡å¼ (ç›‘æ§)

**ç‰¹ç‚¹**:
- è®°å½•æ‰€æœ‰é«˜é£é™©è¿æ¥
- ä¸é˜»æ–­ä»»ä½•æµé‡
- é€‚åˆæµ‹è¯•å’Œè°ƒè¯•
- æ— æœåŠ¡ä¸­æ–­é£é™©

**å¯ç”¨æ–¹æ³•**:
```bash
curl -X POST http://localhost:3006/orasrs/v1/kernel/config \
  -H "Content-Type: application/json" \
  -d '{"mode": "monitor"}'
```

#### Enforce æ¨¡å¼ (å¼ºåˆ¶)

**ç‰¹ç‚¹**:
- å®æ—¶é˜»æ–­é«˜é£é™©è¿æ¥
- å†…æ ¸çº§ä¿æŠ¤
- é€‚åˆç”Ÿäº§ç¯å¢ƒ
- éœ€è¦é…ç½®ç™½åå•

**å¯ç”¨æ–¹æ³•**:
```bash
curl -X POST http://localhost:3006/orasrs/v1/kernel/config \
  -H "Content-Type: application/json" \
  -d '{"mode": "enforce"}'
```

**âš ï¸ æ³¨æ„äº‹é¡¹**:
1. åˆ‡æ¢åˆ° enforce æ¨¡å¼å‰ï¼Œå…ˆåœ¨ monitor æ¨¡å¼è¿è¡Œä¸€æ®µæ—¶é—´
2. ç¡®ä¿ç™½åå•é…ç½®æ­£ç¡®
3. å‡†å¤‡å¥½åº”æ€¥å›é€€æ–¹æ¡ˆ
4. ç›‘æ§é˜»æ–­æ—¥å¿—ï¼Œé¿å…è¯¯æ€

### é…ç½®ç®¡ç†

#### è°ƒæ•´é£é™©é˜ˆå€¼

```bash
# æé«˜é˜ˆå€¼ (æ›´å®½æ¾)
curl -X POST http://localhost:3006/orasrs/v1/kernel/config \
  -H "Content-Type: application/json" \
  -d '{"riskThreshold": 90}'

# é™ä½é˜ˆå€¼ (æ›´ä¸¥æ ¼)
curl -X POST http://localhost:3006/orasrs/v1/kernel/config \
  -H "Content-Type: application/json" \
  -d '{"riskThreshold": 70}'
```

#### è°ƒæ•´ç¼“å­˜æ›´æ–°é—´éš”

```bash
# æ›´é¢‘ç¹æ›´æ–° (5 åˆ†é’Ÿ)
curl -X POST http://localhost:3006/orasrs/v1/kernel/config \
  -H "Content-Type: application/json" \
  -d '{"cacheUpdateInterval": 300000}'

# æ›´å°‘æ›´æ–° (30 åˆ†é’Ÿ)
curl -X POST http://localhost:3006/orasrs/v1/kernel/config \
  -H "Content-Type: application/json" \
  -d '{"cacheUpdateInterval": 1800000}'
```

### ç›‘æ§å’Œæ—¥å¿—

#### æŸ¥çœ‹ eBPF ç¨‹åº

```bash
# åˆ—å‡ºæ‰€æœ‰ eBPF ç¨‹åº
sudo bpftool prog list

# æŸ¥çœ‹ OraSRS XDP ç¨‹åº
sudo bpftool prog list | grep xdp
```

#### æŸ¥çœ‹ BPF Map

```bash
# åˆ—å‡ºæ‰€æœ‰ BPF Map
sudo bpftool map list

# æŸ¥çœ‹é£é™©ç¼“å­˜ Map
sudo bpftool map dump name risk_cache
```

#### æŸ¥çœ‹å†…æ ¸æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹
sudo dmesg -w | grep OraSRS

# æŸ¥çœ‹æœ€è¿‘æ—¥å¿—
sudo dmesg | grep OraSRS | tail -20
```

#### æŸ¥çœ‹æœåŠ¡æ—¥å¿—

```bash
# å®æ—¶æ—¥å¿—
sudo journalctl -u orasrs-client -f

# æœ€è¿‘ 100 è¡Œ
sudo journalctl -u orasrs-client -n 100

# æŒ‰æ—¶é—´è¿‡æ»¤
sudo journalctl -u orasrs-client --since "1 hour ago"
```

---

## æ€§èƒ½ä¼˜åŒ–

### å†…æ ¸å‚æ•°ä¼˜åŒ–

ç¼–è¾‘ `/etc/sysctl.conf`:

```bash
# å¢åŠ  BPF Map å¤§å°é™åˆ¶
kernel.bpf.max_map_size = 16777216

# å¢åŠ  eBPF ç¨‹åºå¤§å°é™åˆ¶
kernel.bpf.max_prog_size = 1048576

# å¯ç”¨ JIT ç¼–è¯‘
net.core.bpf_jit_enable = 1

# ä¼˜åŒ–ç½‘ç»œæ€§èƒ½
net.core.netdev_max_backlog = 5000
net.core.rmem_max = 134217728
net.core.wmem_max = 134217728
```

åº”ç”¨é…ç½®:
```bash
sudo sysctl -p
```

### ç½‘å¡ä¼˜åŒ–

```bash
# å¢åŠ  RX é˜Ÿåˆ—å¤§å°
sudo ethtool -G eth0 rx 4096

# å¯ç”¨ RSS (Receive Side Scaling)
sudo ethtool -L eth0 combined 4

# ç¦ç”¨ä¸å¿…è¦çš„ offload
sudo ethtool -K eth0 gro off
sudo ethtool -K eth0 lro off
```

### åº”ç”¨å±‚ä¼˜åŒ–

#### è°ƒæ•´ç¼“å­˜å¤§å°

åœ¨é…ç½®æ–‡ä»¶ä¸­:
```json
{
  "egressProtection": {
    "cacheUpdateInterval": 300000,
    "maxCacheSize": 10000
  }
}
```

#### è°ƒæ•´æ›´æ–°é¢‘ç‡

```bash
# ç”Ÿäº§ç¯å¢ƒ: æ¯ 10 åˆ†é’Ÿ
"cacheUpdateInterval": 600000

# é«˜å®‰å…¨ç¯å¢ƒ: æ¯ 5 åˆ†é’Ÿ
"cacheUpdateInterval": 300000

# ä½æµé‡ç¯å¢ƒ: æ¯ 30 åˆ†é’Ÿ
"cacheUpdateInterval": 1800000
```

---

## æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

#### 1. eBPF åŠ è½½å¤±è´¥

**ç—‡çŠ¶**:
```
âŒ eBPF å†…æ ¸åŠ é€Ÿå¯åŠ¨å¤±è´¥: eBPF process failed to start
```

**æ’æŸ¥æ­¥éª¤**:

1. æ£€æŸ¥å†…æ ¸ç‰ˆæœ¬:
```bash
uname -r
# éœ€è¦ >= 4.8
```

2. æ£€æŸ¥ BCC å®‰è£…:
```bash
python3 -c "from bcc import BPF"
```

3. æ£€æŸ¥æƒé™:
```bash
# å¿…é¡»ä»¥ root è¿è¡Œ
whoami
```

4. æ£€æŸ¥ç½‘å¡:
```bash
ip link show eth0
```

5. æŸ¥çœ‹è¯¦ç»†é”™è¯¯:
```bash
sudo journalctl -u orasrs-client -n 50
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# é‡æ–°å®‰è£… BCC
sudo apt install --reinstall bpfcc-tools python3-bpfcc

# é‡å¯æœåŠ¡
sudo systemctl restart orasrs-client
```

#### 2. æ€§èƒ½ä¸‹é™

**ç—‡çŠ¶**:
- æŸ¥è¯¢å»¶è¿Ÿå¢åŠ 
- TPS ä¸‹é™
- CPU ä½¿ç”¨ç‡é«˜

**æ’æŸ¥æ­¥éª¤**:

1. æ£€æŸ¥ BPF Map å¤§å°:
```bash
sudo bpftool map list | grep risk_cache
```

2. æ£€æŸ¥ç»Ÿè®¡ä¿¡æ¯:
```bash
orasrs-cli kernel --detailed
```

3. æ£€æŸ¥ç³»ç»Ÿèµ„æº:
```bash
top
free -h
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ¸…ç†è¿‡æœŸæ•°æ®
curl -X POST http://localhost:3006/orasrs/v1/cache/clear

# é‡æ–°åŒæ­¥
orasrs-cli kernel-sync

# è°ƒæ•´ç¼“å­˜å¤§å°
curl -X POST http://localhost:3006/orasrs/v1/kernel/config \
  -d '{"maxCacheSize": 5000}'
```

#### 3. è¯¯é˜»æ–­

**ç—‡çŠ¶**:
- æ­£å¸¸æµé‡è¢«é˜»æ–­
- ç™½åå• IP è¢«é˜»æ–­

**æ’æŸ¥æ­¥éª¤**:

1. æ£€æŸ¥æ¨¡å¼:
```bash
orasrs-cli kernel | grep "æ¨¡å¼"
```

2. æ£€æŸ¥é˜»æ–­æ—¥å¿—:
```bash
sudo dmesg | grep "BLOCKED"
```

3. æ£€æŸ¥ç™½åå•:
```bash
curl http://localhost:3006/orasrs/v1/whitelist
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# ä¸´æ—¶åˆ‡æ¢åˆ° monitor æ¨¡å¼
curl -X POST http://localhost:3006/orasrs/v1/kernel/config \
  -d '{"mode": "monitor"}'

# æ·»åŠ åˆ°ç™½åå•
orasrs-cli whitelist add <IP>

# è°ƒæ•´é£é™©é˜ˆå€¼
curl -X POST http://localhost:3006/orasrs/v1/kernel/config \
  -d '{"riskThreshold": 90}'
```

---

## æœ€ä½³å®è·µ

### éƒ¨ç½²å»ºè®®

1. **åˆ†é˜¶æ®µéƒ¨ç½²**:
   - ç¬¬ 1 å‘¨: monitor æ¨¡å¼ï¼Œæ”¶é›†æ•°æ®
   - ç¬¬ 2 å‘¨: è°ƒæ•´ç™½åå•å’Œé˜ˆå€¼
   - ç¬¬ 3 å‘¨: enforce æ¨¡å¼ï¼Œå°èŒƒå›´æµ‹è¯•
   - ç¬¬ 4 å‘¨: å…¨é¢å¯ç”¨

2. **ç™½åå•é…ç½®**:
   - æ·»åŠ å†…éƒ¨ IP æ®µ
   - æ·»åŠ å…³é”®ä¸šåŠ¡ IP
   - æ·»åŠ  CDN èŠ‚ç‚¹
   - æ·»åŠ  DNS æœåŠ¡å™¨

3. **ç›‘æ§å‘Šè­¦**:
   - è®¾ç½®é˜»æ–­ç‡å‘Šè­¦ (> 5%)
   - è®¾ç½®æ€§èƒ½å‘Šè­¦ (å»¶è¿Ÿ > 1ms)
   - è®¾ç½®é”™è¯¯å‘Šè­¦
   - å®šæœŸå®¡æŸ¥æ—¥å¿—

4. **åº”æ€¥é¢„æ¡ˆ**:
   - å‡†å¤‡å¿«é€Ÿå›é€€è„šæœ¬
   - ä¿ç•™å¤‡ç”¨ç™½åå•
   - æ–‡æ¡£åŒ–æ“ä½œæµç¨‹
   - å»ºç«‹å€¼ç­æœºåˆ¶

### å®‰å…¨å»ºè®®

1. **æœ€å°æƒé™åŸåˆ™**:
   - ä»… root ç”¨æˆ·è¿è¡Œ
   - é™åˆ¶ API è®¿é—® (127.0.0.1)
   - ä½¿ç”¨é˜²ç«å¢™ä¿æŠ¤

2. **å®šæœŸæ›´æ–°**:
   - æ¯å‘¨åŒæ­¥å¨èƒæ•°æ®
   - æ¯æœˆæ›´æ–°å®¢æˆ·ç«¯
   - å…³æ³¨å®‰å…¨å…¬å‘Š

3. **å®¡è®¡æ—¥å¿—**:
   - å¯ç”¨è¯¦ç»†æ—¥å¿—
   - å®šæœŸå½’æ¡£
   - ä¿ç•™ 90 å¤©

---

## FAQ

### Q1: eBPF ä¼šå½±å“ç½‘ç»œæ€§èƒ½å—ï¼Ÿ

**A**: ä¸ä¼šã€‚eBPF XDP åœ¨ç½‘ç»œé©±åŠ¨å±‚å¤„ç†ï¼Œå»¶è¿Ÿ < 0.04msï¼Œå¯¹æ­£å¸¸æµé‡å‡ ä¹æ— å½±å“ã€‚å®æµ‹æ˜¾ç¤ºï¼š
- å»¶è¿Ÿå¢åŠ : < 0.1ms
- ååé‡æŸå¤±: < 1%
- CPU å¼€é”€: < 2%

### Q2: æ”¯æŒå“ªäº› Linux å‘è¡Œç‰ˆï¼Ÿ

**A**: æ”¯æŒæ‰€æœ‰å†…æ ¸ >= 4.8 çš„å‘è¡Œç‰ˆï¼š
- Ubuntu 18.04+
- Debian 10+
- CentOS 8+
- RHEL 8+
- Fedora 30+

### Q3: å¯ä»¥åœ¨è™šæ‹Ÿæœºä¸­ä½¿ç”¨å—ï¼Ÿ

**A**: å¯ä»¥ï¼Œä½†éœ€è¦ï¼š
- è™šæ‹ŸåŒ–å¹³å°æ”¯æŒ (KVM, VMware)
- è™šæ‹Ÿç½‘å¡æ”¯æŒ XDP (virtio_net)
- å†…æ ¸ç‰ˆæœ¬ >= 4.8

### Q4: å¦‚ä½•éªŒè¯ eBPF æ­£åœ¨å·¥ä½œï¼Ÿ

**A**: 
```bash
# 1. æ£€æŸ¥ eBPF ç¨‹åº
sudo bpftool prog list | grep xdp

# 2. æ£€æŸ¥ç»Ÿè®¡ä¿¡æ¯
orasrs-cli kernel --detailed

# 3. æµ‹è¯•é˜»æ–­
# (åœ¨ enforce æ¨¡å¼ä¸‹è®¿é—®é«˜é£é™© IP)
```

### Q5: å¯ä»¥è‡ªå®šä¹‰é£é™©è¯„åˆ†å—ï¼Ÿ

**A**: å¯ä»¥é€šè¿‡ API æ›´æ–°ï¼š
```bash
curl -X POST http://localhost:3006/orasrs/v1/kernel/config \
  -d '{"riskThreshold": 85}'
```

### Q6: æ”¯æŒ IPv6 å—ï¼Ÿ

**A**: å½“å‰ç‰ˆæœ¬ä»…æ”¯æŒ IPv4ã€‚IPv6 æ”¯æŒè®¡åˆ’åœ¨ä¸‹ä¸€ç‰ˆæœ¬ä¸­å®ç°ã€‚

### Q7: å¦‚ä½•å¸è½½ eBPFï¼Ÿ

**A**:
```bash
# æ–¹æ³• 1: ç¦ç”¨é…ç½®
curl -X POST http://localhost:3006/orasrs/v1/kernel/config \
  -d '{"mode": "disabled"}'

# æ–¹æ³• 2: ä¿®æ”¹é…ç½®æ–‡ä»¶
# è®¾ç½® "enabled": false

# æ–¹æ³• 3: é‡å¯æœåŠ¡
sudo systemctl restart orasrs-client
```

---

## é™„å½•

### A. é…ç½®æ–‡ä»¶å®Œæ•´ç¤ºä¾‹

```json
{
  "port": 3006,
  "host": "127.0.0.1",
  "blockchain": {
    "endpoint": "https://api.orasrs.net",
    "chainId": 8888
  },
  "egressProtection": {
    "enabled": true,
    "mode": "monitor",
    "interface": "eth0",
    "riskThreshold": 80,
    "cacheUpdateInterval": 300000,
    "maxCacheSize": 10000
  },
  "security": {
    "enableRateLimiting": true,
    "enableCORS": true,
    "corsOrigin": "*",
    "whitelist": ["127.0.0.1", "localhost", "::1"]
  }
}
```

### B. å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

```bash
# çŠ¶æ€æŸ¥çœ‹
orasrs-cli kernel                    # åŸºæœ¬çŠ¶æ€
orasrs-cli kernel --detailed         # è¯¦ç»†ç»Ÿè®¡
orasrs-cli status                    # æœåŠ¡çŠ¶æ€

# é…ç½®ç®¡ç†
orasrs-cli kernel-sync               # åŒæ­¥æ•°æ®
orasrs-cli whitelist add <IP>        # æ·»åŠ ç™½åå•
orasrs-cli whitelist remove <IP>     # ç§»é™¤ç™½åå•

# æœåŠ¡ç®¡ç†
sudo systemctl start orasrs-client   # å¯åŠ¨
sudo systemctl stop orasrs-client    # åœæ­¢
sudo systemctl restart orasrs-client # é‡å¯
sudo systemctl status orasrs-client  # çŠ¶æ€

# æ—¥å¿—æŸ¥çœ‹
sudo journalctl -u orasrs-client -f  # å®æ—¶æ—¥å¿—
sudo dmesg | grep OraSRS             # å†…æ ¸æ—¥å¿—
```

### C. æ€§èƒ½åŸºå‡†å‚è€ƒ

| åœºæ™¯ | å»¶è¿Ÿ | TPS | CPU | å†…å­˜ |
|------|------|-----|-----|------|
| çº¯ç¼“å­˜æ¨¡å¼ | ~10ms | ~1,000 | 1% | 30MB |
| eBPF monitor | ~0.01ms | ~15,000 | 2% | 45MB |
| eBPF enforce | ~0.01ms | ~15,000 | 2% | 45MB |

---

## è”ç³»æ”¯æŒ

- GitHub Issues: https://github.com/srs-protocol/OraSRS-protocol/issues
- æ–‡æ¡£: https://github.com/srs-protocol/OraSRS-protocol
- é‚®ç®±: support@orasrs.net
