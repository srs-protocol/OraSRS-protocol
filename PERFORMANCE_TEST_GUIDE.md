# OraSRS 协议性能测试复现指南

本文档说明如何使用一键测试脚本复现 OraSRS 协议的性能测试结果。

## 一键测试脚本

我们提供了一个一键测试脚本，可以自动运行性能测试并生成结果报告：

```bash
./run-performance-test.sh
```

## 测试内容

该脚本将执行以下测试：

1. **单个IP查询性能测试** - 测试单个IP查询的响应时间和吞吐量
2. **批量IP查询性能测试** - 测试批量IP查询的性能表现
3. **协议链连接测试** - 验证与 OraSRS 协议链的连接能力
4. **速率限制测试** - 验证客户端是否正确实现了速率限制

## 预期结果

运行测试后，将生成以下文件：

- `oraSRS-client-performance-report.json` - 详细的性能测试报告
- `test-ip-list.json` - 测试使用的IP列表

## 测试配置

- 速率限制：20r/s（每秒最多20个请求）
- 并发连接限制：每个IP最多10个并发连接
- 缓存大小：10MB
- 测试IP数量：1000个IP用于性能测试

## 重现步骤

1. 确保已安装 Node.js
2. 运行一键测试脚本：
   ```bash
   ./run-performance-test.sh
   ```
3. 等待测试完成
4. 检查生成的测试报告

## 预期输出

测试完成后，您应该看到类似以下的输出：

```
🚀 开始OraSRS客户端IP查询性能测试...

📊 开始单个IP查询性能测试 (应用速率限制: 20r/s)...
...
==================== 测试结果 ====================
单个IP查询测试:
  查询数量: 1000
  总耗时: 92626ms
  平均响应时间: 92.6260ms
  QPS: 10.80

批量IP查询测试:
  查询数量: 100
  总耗时: 5028ms
  平均响应时间: 50.2700ms
  QPS: 19.89

缓存统计:
  总查询数: 1100
  缓存命中: 1100
  缓存未命中: 0
  缓存命中率: 100.00%
  平均查询时间: 0.0155ms
...
✅ 性能测试完成！
```

## 常见问题

- 如果出现503错误，这是正常的，表示服务器在某些时候不可用，客户端会正确处理这些错误
- QPS值应在10-20之间，符合速率限制设置
- 测试可能需要几分钟时间完成，请耐心等待