# ğŸ›¡ï¸ OraSRS IoT Shield (ç‰©è”ç½‘æŠ¤ç›¾)

å¯¹äºç‰¹æ®Šå›ºä»¶ï¼ˆæ‘„åƒå¤´ã€ä¼ æ„Ÿå™¨ã€æ™ºèƒ½é—¨é”ç­‰ï¼‰å®è¡Œâ€œå…ˆæŸ¥è¯¢åæ”¾è¡Œâ€çš„é…ç½®ã€‚é€šè¿‡éƒ¨ç½²é€æ˜æ¸…æ´—å±‚ï¼Œå…¨é¢æ¨è¿›ç‰©è”ç½‘å®‰å…¨ã€‚

## 1. æ ¸å¿ƒç†å¿µï¼šé™ç»´æ‰“å‡»

OraSRS IoT Shield é€šè¿‡ä»¥ä¸‹ä¸‰ä¸ªç»´åº¦å®ç°å¯¹ä¼ ç»Ÿæ”»å‡»æ–¹å¼çš„é™ç»´æ‰“å‡»ï¼š

### 1.1 ä»â€œåŸºäºç‰¹å¾â€åˆ°â€œåŸºäºä¿¡èª‰â€
- **ä¼ ç»Ÿé˜²å¾¡**: ä¾èµ–å·²çŸ¥çš„æ”»å‡»ç‰¹å¾ç  (Signature)ï¼Œå¯¹ 0-day æ¼æ´æ— æ•ˆã€‚
- **OraSRS**: ä¾é  IP çš„å…¨ç½‘ä¿¡èª‰é˜²å¾¡ã€‚æ”»å‡»è€…ä¸€æ—¦åœ¨ç½‘ç»œä¸­è¡¨ç°å‡ºæ¶æ„è¡Œä¸ºï¼ˆå¦‚æ‰«æï¼‰ï¼Œå…¶ä¿¡èª‰åˆ†ä¸‹é™ï¼Œç«‹åˆ»è¢«æ‚¨çš„è®¾å¤‡æ‹’ä¹‹é—¨å¤–ï¼Œæ ¹æœ¬æ²¡æœ‰æœºä¼šå‘é€ Payloadã€‚

### 1.2 ä»â€œè¢«åŠ¨é˜²å¾¡â€åˆ°â€œéšèº«é˜²å¾¡â€
- **ä¼ ç»Ÿé˜²å¾¡**: æš´éœ²ç™»å½•é¡µé¢ï¼Œä¾èµ–å¼ºå¯†ç å’Œé”™è¯¯å°ç¦ã€‚
- **OraSRS**: â€œå…ˆæŸ¥è¯¢åæ”¾è¡Œâ€æœºåˆ¶ç›´æ¥éšè—äº†æœåŠ¡å…¥å£ã€‚å¯¹äºé«˜é£é™© IPï¼Œç½‘å…³ç›´æ¥æ‹’ç»è¿æ¥ï¼Œæ”»å‡»è€…æ— æ³•æ¢æµ‹åˆ°æœåŠ¡çš„å­˜åœ¨ã€‚

### 1.3 ä¸ºâ€œç»ˆç«¯â€èµ‹äºˆâ€œç¾¤ä½“æ™ºæ…§â€
- **ç°çŠ¶**: æ‘„åƒå¤´ç­‰è®¾å¤‡ç®—åŠ›å¼±ï¼Œæ— æ³•è¿è¡Œå¤æ‚çš„é˜²æŠ¤è½¯ä»¶ã€‚
- **OraSRS**: é€šè¿‡ç½‘å…³å…±äº«å…¨çƒèŠ‚ç‚¹çš„å¨èƒæƒ…æŠ¥ã€‚ç¾å›½èŠ‚ç‚¹å‘ç°çš„å¨èƒï¼Œæ‚¨å®¶é‡Œçš„æ‘„åƒå¤´æ¯«ç§’çº§å°±èƒ½å…ç–«ã€‚

## 2. éƒ¨ç½²æ¶æ„

ç”±äºæ— æ³•ä¿®æ”¹æ‘„åƒå¤´å†…éƒ¨å›ºä»¶ï¼Œæˆ‘ä»¬åœ¨æ‘„åƒå¤´å’Œäº’è”ç½‘ä¹‹é—´éƒ¨ç½²ä¸€ä¸ª**â€œé€æ˜æ¸…æ´—å±‚â€**ã€‚

### ç‰©ç†/é€»è¾‘æ‹“æ‰‘

```mermaid
graph TD
    Attacker[äº’è”ç½‘ / æ”»å‡»è€…] -->|æ¶æ„æµé‡| Gateway
    User[åˆæ³•ç”¨æˆ·] -->|æ­£å¸¸è®¿é—®| Gateway
    
    subgraph "é€æ˜æ¸…æ´—å±‚ (Raspberry Pi / OpenWrt)"
        Gateway[æ™ºèƒ½ç½‘å…³ / è¾¹ç¼˜è·¯ç”±å™¨]
        Agent[OraSRS å®¢æˆ·ç«¯]
        Nginx[Nginx / OpenResty]
        
        Gateway --> Nginx
        Nginx --"1. é‰´æƒè¯·æ±‚ (auth_request)"--> Agent
        Agent --"2. è¿”å› 200/403"--> Nginx
    end
    
    subgraph "å—ä¿æŠ¤è®¾å¤‡"
        Camera[ç‰¹æ®Šå›ºä»¶è®¾å¤‡ (æ‘„åƒå¤´)]
    end
    
    Nginx --"3. æ”¾è¡Œæµé‡ (ä»…é™ä½é£é™©)"--> Camera
```

**é…ç½®è¦ç‚¹**:
- æ‘„åƒå¤´é…ç½®ä¸ºä»…æ¥å—æ¥è‡ªç½‘å…³ IP çš„æµé‡ï¼Œæ‹’ç»æ‰€æœ‰ç›´è¿ã€‚
- ç½‘å…³ä½œä¸ºåå‘ä»£ç†ï¼Œæ¥ç®¡æ‰€æœ‰å¤–éƒ¨è®¿é—®ã€‚

## 3. é…ç½®æŒ‡å—

### 3.1 å¯åŠ¨ OraSRS å®¢æˆ·ç«¯
ç¡®ä¿ OraSRS å®¢æˆ·ç«¯å·²å®‰è£…å¹¶è¿è¡Œåœ¨ç½‘å…³ä¸Š (é»˜è®¤ç«¯å£ 3006)ã€‚

### 3.2 é…ç½® Nginx (é€æ˜æ¸…æ´—)

åœ¨ Nginx é…ç½®ä¸­ä½¿ç”¨ `auth_request` æ¨¡å—å®ç°â€œå…ˆæŸ¥è¯¢åæ”¾è¡Œâ€ã€‚

```nginx
http {
    # å®šä¹‰ OraSRS æ£€æŸ¥ä¸Šæ¸¸
    upstream orasrs_check {
        server 127.0.0.1:3006;
    }

    server {
        listen 80;
        server_name camera.example.com;

        # æ ¸å¿ƒé˜²çº¿ï¼šæ‰€æœ‰è¯·æ±‚å…ˆç»è¿‡ OraSRS æ£€æŸ¥
        location / {
            auth_request /auth_check;
            
            # åªæœ‰é€šè¿‡æ£€æŸ¥çš„è¯·æ±‚æ‰ä¼šè¢«è½¬å‘ç»™æ‘„åƒå¤´
            proxy_pass http://192.168.1.100:80; # æ‘„åƒå¤´å†…ç½‘IP
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # å†…éƒ¨é‰´æƒæ¥å£
        location = /auth_check {
            internal;
            proxy_pass http://orasrs_check/orasrs/v1/check?ip=$remote_addr;
            proxy_pass_request_body off;
            proxy_set_header Content-Length "";
            proxy_set_header X-Original-URI $request_uri;
        }

        # é”™è¯¯é¡µé¢ (æ‹¦æˆªæç¤º)
        error_page 403 = @error403;
        location @error403 {
            default_type text/plain;
            return 403 "Access Denied by OraSRS IoT Shield: High Risk IP Detected.";
        }
    }
}
```

### 3.3 åº”æ€¥ç™½åå•
å¦‚æœè¯¯æ‹¦äº†åˆæ³•ç”¨æˆ·ï¼Œç®¡ç†å‘˜å¯é€šè¿‡ API ä¸´æ—¶æ”¾è¡Œï¼š

```bash
curl -X POST http://127.0.0.1:3006/orasrs/v1/whitelist/temp \
  -H "Content-Type: application/json" \
  -d '{"ip":"ç”¨æˆ·IP", "duration":3600}'
```

## 4. æ€»ç»“
OraSRS IoT Shield ä¸ä»…ä»…æ˜¯ä¸€ä¸ªé˜²ç«å¢™ï¼Œå®ƒæ˜¯ç‰©è”ç½‘è®¾å¤‡çš„**ä¸»åŠ¨å…ç–«ç³»ç»Ÿ**ã€‚é€šè¿‡å°†å®‰å…¨è¾¹ç•Œå‰ç§»è‡³ç½‘å…³ï¼Œå¹¶åˆ©ç”¨åŒºå—é“¾å…±è¯†çš„å¨èƒæƒ…æŠ¥ï¼Œæˆ‘ä»¬ä¸ºæ— æ³•è‡ªæˆ‘ä¿æŠ¤çš„è®¾å¤‡ç©¿ä¸Šäº†ä¸€å±‚éšå½¢çš„é˜²å¼¹è¡£ã€‚
