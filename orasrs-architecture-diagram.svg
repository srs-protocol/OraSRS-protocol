<?xml version="1.0" encoding="UTF-8"?>
<svg width="1200" height="800" xmlns="http://www.w3.org/2000/svg">
  <style>
    .layer-title { font: bold 20px sans-serif; fill: #2c3e50; }
    .component-title { font: bold 16px sans-serif; fill: #2c3e50; }
    .component-desc { font: 14px sans-serif; fill: #34495e; }
    .arrow { stroke: #3498db; stroke-width: 2; marker-end: url(#arrowhead); }
    .data-flow { stroke: #e74c3c; stroke-width: 2; stroke-dasharray: 5,5; marker-end: url(#arrowhead); }
    .chain { fill: #27ae60; }
    .agent { fill: #3498db; }
    .integration { fill: #9b59b6; }
    .external { fill: #e67e22; }
    .node { fill: #ecf0f1; stroke: #34495e; stroke-width: 2; rx: 10; ry: 10; }
    .legend-title { font: bold 14px sans-serif; fill: #2c3e50; }
  </style>

  <!-- Arrowhead Definition -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#3498db" />
    </marker>
  </defs>

  <!-- Layers -->
  <!-- Data Acquisition Layer -->
  <rect x="50" y="50" width="1100" height="180" fill="#e3f2fd" stroke="#2196f3" stroke-width="2" />
  <text x="600" y="80" class="layer-title" text-anchor="middle">数据采集层 (Data Acquisition Layer)</text>
  
  <!-- Protocol Core Layer -->
  <rect x="50" y="280" width="1100" height="220" fill="#f3e5f5" stroke="#9c27b0" stroke-width="2" />
  <text x="600" y="310" class="layer-title" text-anchor="middle">协议核心层 (Protocol Core Layer)</text>
  
  <!-- Application & Integration Layer -->
  <rect x="50" y="550" width="1100" height="200" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" />
  <text x="600" y="580" class="layer-title" text-anchor="middle">应用与集成层 (Application & Integration Layer)</text>

  <!-- Data Sources -->
  <g transform="translate(100, 120)">
    <rect class="node external" width="200" height="80" />
    <text x="100" y="30" class="component-title" text-anchor="middle">链下数据源</text>
    <text x="100" y="55" class="component-desc" text-anchor="middle">网络日志、安全事件</text>
    <text x="100" y="75" class="component-desc" text-anchor="middle">(SIEM/IDS/IPS、业务数据)</text>
  </g>

  <!-- OraSRS Agent -->
  <g transform="translate(400, 120)">
    <rect class="node agent" width="200" height="80" />
    <text x="100" y="30" class="component-title" text-anchor="middle">OraSRS Agent</text>
    <text x="100" y="55" class="component-desc" text-anchor="middle">数据代理 - 协议核心执行单元</text>
    <text x="100" y="75" class="component-desc" text-anchor="middle">(监听数据源，数据清洗和标准化)</text>
  </g>

  <!-- Threat Evidence Contract -->
  <g transform="translate(700, 120)">
    <rect class="node agent" width="200" height="80" />
    <text x="100" y="30" class="component-title" text-anchor="middle">威胁证据合约</text>
    <text x="100" y="55" class="component-desc" text-anchor="middle">威胁证据收集与存储</text>
    <text x="100" y="75" class="component-desc" text-anchor="middle">(ThreatEvidence.sol)</text>
  </g>

  <!-- Blockchain Network -->
  <g transform="translate(100, 350)">
    <rect class="node chain" width="200" height="80" />
    <text x="100" y="30" class="component-title" text-anchor="middle">区块链网络</text>
    <text x="100" y="55" class="component-desc" text-anchor="middle">(ChainMaker)</text>
    <text x="100" y="75" class="component-desc" text-anchor="middle">国密算法支持</text>
  </g>

  <!-- Smart Contracts -->
  <g transform="translate(400, 350)">
    <rect class="node chain" width="200" height="80" />
    <text x="100" y="30" class="component-title" text-anchor="middle">智能合约</text>
    <text x="100" y="55" class="component-desc" text-anchor="middle">风险评分逻辑</text>
    <text x="100" y="75" class="component-desc" text-anchor="middle">(执行不可篡改的风险评分算法)</text>
  </g>

  <!-- Governance Contract -->
  <g transform="translate(700, 350)">
    <rect class="node chain" width="200" height="80" />
    <text x="100" y="30" class="component-title" text-anchor="middle">治理合约</text>
    <text x="100" y="55" class="component-desc" text-anchor="middle">OraSRSGovernance</text>
    <text x="100" y="75" class="component-desc" text-anchor="middle">(声誉系统、节点管理)</text>
  </g>

  <!-- Threat Intelligence Coordination Contract -->
  <g transform="translate(1000, 350)">
    <rect class="node chain" width="150" height="80" />
    <text x="75" y="30" class="component-title" text-anchor="middle">威胁情报</text>
    <text x="75" y="55" class="component-desc" text-anchor="middle">协调合约</text>
    <text x="75" y="75" class="component-desc" text-anchor="middle">(ThreatIntelligenceCoordination.sol)</text>
  </g>

  <!-- Risk Score Output -->
  <g transform="translate(400, 620)">
    <rect class="node integration" width="200" height="80" />
    <text x="100" y="30" class="component-title" text-anchor="middle">风险评分输出</text>
    <text x="100" y="55" class="component-desc" text-anchor="middle">协议最终产物</text>
    <text x="100" y="75" class="component-desc" text-anchor="middle">(通过智能合约接口提供查询)</text>
  </g>

  <!-- Enterprise Integration Endpoints -->
  <g transform="translate(100, 700)">
    <rect class="node integration" width="150" height="60" />
    <text x="75" y="25" class="component-title" text-anchor="middle">Prometheus/</text>
    <text x="75" y="45" class="component-desc" text-anchor="middle">Grafana</text>
  </g>

  <g transform="translate(275, 700)">
    <rect class="node integration" width="150" height="60" />
    <text x="75" y="25" class="component-title" text-anchor="middle">Splunk</text>
    <text x="75" y="45" class="component-desc" text-anchor="middle">(集中日志分析)</text>
  </g>

  <g transform="translate(450, 700)">
    <rect class="node integration" width="150" height="60" />
    <text x="75" y="25" class="component-title" text-anchor="middle">XSOAR/SOAR</text>
    <text x="75" y="45" class="component-desc" text-anchor="middle">(自动化响应)</text>
  </g>

  <g transform="translate(625, 700)">
    <rect class="node integration" width="150" height="60" />
    <text x="75" y="25" class="component-title" text-anchor="middle">pfSense</text>
    <text x="75" y="45" class="component-desc" text-anchor="middle">(防火墙插件)</text>
  </g>

  <g transform="translate(800, 700)">
    <rect class="node integration" width="150" height="60" />
    <text x="75" y="25" class="component-title" text-anchor="middle">其他企业工具</text>
    <text x="75" y="45" class="component-desc" text-anchor="middle">(可扩展)</text>
  </g>

  <!-- Data Flow Arrows -->
  <!-- Data Source to Agent -->
  <line x1="300" y1="160" x2="400" y2="160" class="arrow" />
  <text x="350" y="150" font-size="12" fill="#34495e" text-anchor="middle">原始风险数据</text>

  <!-- Agent to Threat Evidence Contract -->
  <line x1="600" y1="160" x2="700" y2="160" class="arrow" />
  <text x="650" y="150" font-size="12" fill="#34495e" text-anchor="middle">标准化数据</text>

  <!-- Agent to Blockchain -->
  <line x1="500" y1="200" x2="200" y2="350" class="arrow" />
  <text x="350" y="250" font-size="12" fill="#34495e" text-anchor="middle">威胁证据</text>

  <!-- Agent to Smart Contracts -->
  <line x1="500" y1="200" x2="500" y2="350" class="arrow" />
  <text x="510" y="280" font-size="12" fill="#34495e" text-anchor="start">风险评分请求</text>

  <!-- Agent to Governance Contract -->
  <line x1="500" y1="200" x2="800" y2="350" class="arrow" />
  <text x="650" y="270" font-size="12" fill="#34495e" text-anchor="middle">节点声誉数据</text>

  <!-- Smart Contracts to Risk Score Output -->
  <line x1="500" y1="430" x2="500" y2="620" class="arrow" />
  <text x="510" y="530" font-size="12" fill="#34495e" text-anchor="start">链上评分结果</text>

  <!-- Risk Score Output to Integration Endpoints -->
  <line x1="400" y1="700" x2="175" y2="700" class="data-flow" />
  <line x1="400" y1="700" x2="350" y2="700" class="data-flow" />
  <line x1="400" y1="700" x2="525" y2="700" class="data-flow" />
  <line x1="400" y1="700" x2="700" y2="700" class="data-flow" />
  <line x1="400" y1="700" x2="875" y2="700" class="data-flow" />
  
  <text x="280" y="690" font-size="12" fill="#e74c3c" text-anchor="middle">评分结果推送</text>

  <!-- Legend -->
  <g transform="translate(950, 600)">
    <rect width="200" height="150" fill="white" stroke="#ccc" />
    <text x="100" y="20" class="legend-title" text-anchor="middle">图例</text>
    <rect x="10" y="30" width="20" height="20" class="agent" />
    <text x="40" y="45" font-size="12" fill="#2c3e50">链下组件</text>
    <rect x="10" y="60" width="20" height="20" class="chain" />
    <text x="40" y="75" font-size="12" fill="#2c3e50">链上组件</text>
    <rect x="10" y="90" width="20" height="20" class="integration" />
    <text x="40" y="105" font-size="12" fill="#2c3e50">集成组件</text>
    <rect x="10" y="120" width="20" height="20" class="external" />
    <text x="40" y="135" font-size="12" fill="#2c3e50">外部数据源</text>
  </g>
</svg>